<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nu spelas</title>
<style>
  :root{ --accent:#c84cff; --text:#f6e9f5; --muted:#e9d3f2; --bar-bg:rgba(255,255,255,.16); --radius:18px; }
  body{margin:0;background:#0b0710;display:grid;place-items:center;font-family:system-ui;color:var(--text)}
  .wrap{width:min(760px,94vw)}
  .card{position:relative;padding:18px 22px;border-radius:var(--radius);overflow:hidden;
        box-shadow:0 20px 50px rgba(0,0,0,.45);display:block;text-decoration:none;color:inherit}
  .bg{position:absolute;inset:0;background-size:cover;background-position:center;
      filter:blur(26px) brightness(70%);transform:scale(1.12);z-index:-2}
  .card::after{content:"";position:absolute;inset:0;background:linear-gradient(120deg,rgba(18,8,22,.70),rgba(35,10,35,.42));z-index:-1}
  .row{display:flex;align-items:center;gap:18px}
  .cover{width:100px;height:100px;flex:0 0 auto;border-radius:50%;overflow:hidden}
  .cover img{width:100%;height:100%;object-fit:cover;border-radius:50%}
  .meta{flex:1;min-width:0}
  .title{margin:0;font-weight:800;font-size:20px}
  .artist{margin:.25rem 0 0;color:var(--muted)}
  .times{margin:.9rem 0 .35rem;display:flex;justify-content:space-between;font-variant-numeric:tabular-nums}
  .progress{height:6px;border-radius:999px;overflow:hidden;background:var(--bar-bg)}
  .bar{height:100%;width:0;background:var(--accent)}
  .empty{text-align:center;padding:24px;color:#e0cade}
</style>
</head>
<body>
<div class="wrap">
  <a id="cardLink" class="card" target="_blank" rel="noopener">
    <div id="bg" class="bg"></div>
    <div id="content" class="row" hidden>
      <div class="cover"><img id="cover" alt=""></div>
      <div class="meta">
        <h1 id="title" class="title">–</h1>
        <div id="artist" class="artist">–</div>
        <div class="times"><span id="tStart">0:00</span><span id="tEnd">0:00</span></div>
        <div class="progress"><div id="bar" class="bar"></div></div>
      </div>
    </div>
    <div id="empty" class="empty">Ingen låt spelas just nu.</div>
  </a>
</div>
<script>
const API_NOW="/now-playing";

const el={
  cardLink:document.getElementById("cardLink"), bg:document.getElementById("bg"),
  content:document.getElementById("content"), empty:document.getElementById("empty"),
  cover:document.getElementById("cover"), title:document.getElementById("title"),
  artist:document.getElementById("artist"), tStart:document.getElementById("tStart"),
  tEnd:document.getElementById("tEnd"), bar:document.getElementById("bar")
};

const ms=(x=0)=>{const s=Math.floor(x/1000),m=Math.floor(s/60);return `${m}:${String(s%60).padStart(2,"0")}`};

async function pollNow(){
  try{
    const r=await fetch(API_NOW,{cache:"no-store"});
    const d=await r.json();
    if(!d||!d.playing){
      el.content.hidden=true; el.empty.hidden=false;
      el.bar.style.width="0%"; return;
    }
    el.empty.hidden=true; el.content.hidden=false;
    el.title.textContent=d.title||"Okänd låt";
    el.artist.textContent=(d.artists||[]).join(", ")||d.album||"";
    el.cover.src=d.image||""; el.bg.style.backgroundImage=`url("${d.image||""}")`;
    el.cardLink.href=d.url||"#";
    el.tEnd.textContent=ms(d.duration_ms||0);
    el.tStart.textContent=ms(d.progress_ms||0);
    const pct=Math.min(100,(100*(d.progress_ms||0)/(d.duration_ms||1)));
    el.bar.style.width=pct+"%";
  }catch(e){}
}

pollNow();
setInterval(pollNow,1000);
</script>
</body>
</html>
