<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nu spelas</title>
<style>
  :root{ --accent:#ff3da0; --text:#f6e9f5; --muted:#f1a7d1; --bar-bg:rgba(255,255,255,.14); --radius:18px; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:#0b0710;display:grid;place-items:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter;color:var(--text)}
  .card{position:relative;width:min(680px,92vw);padding:18px 22px 20px;border-radius:var(--radius);overflow:hidden;box-shadow:0 20px 50px rgba(0,0,0,.45);isolation:isolate}
  .bg{position:absolute;inset:0;background-size:cover;background-position:center;filter:blur(26px) saturate(130%) brightness(70%);transform:scale(1.12);z-index:-2}
  .card::after{content:"";position:absolute;inset:0;background:linear-gradient(120deg,rgba(18,8,22,.70),rgba(35,10,35,.42));z-index:-1}
  .row{display:flex;align-items:center;gap:18px}
  .cover{width:110px;height:110px;flex:0 0 auto;border-radius:50%;padding:5px;background:radial-gradient(closest-side,rgba(255,61,160,.35),rgba(255,61,160,0) 68%),var(--accent);position:relative}
  .cover img{width:100%;height:100%;display:block;border-radius:50%;object-fit:cover;border:4px solid rgba(255,255,255,.12)}
  .cover .play{position:absolute;right:10px;bottom:10px;width:26px;height:26px;border-radius:50%;background:rgba(0,0,0,.45);display:grid;place-items:center;border:1px solid rgba(255,255,255,.25)}
  .cover .play:before{content:"";border-left:10px solid var(--accent);border-top:6px solid transparent;border-bottom:6px solid transparent;margin-left:2px}
  .meta{flex:1;min-width:0}
  .title{margin:0;font-weight:800;letter-spacing:.2px;font-size:22px;line-height:1.2;text-shadow:0 2px 8px rgba(0,0,0,.35)}
  .artist{margin:.25rem 0 0;color:var(--muted);font-weight:600;opacity:.95}
  .times{margin:.9rem 0 .35rem;display:flex;justify-content:space-between;font-variant-numeric:tabular-nums;font-weight:700;color:var(--muted)}
  .times .right{color:var(--accent)}
  .progress{height:8px;border-radius:999px;position:relative;overflow:hidden;background:var(--bar-bg)}
  .bar{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,rgba(255,61,160,.9),rgba(255,144,214,.95))}
  .empty{text-align:center;padding:28px 22px;color:#e0cade;opacity:.85}
  @media (max-width:460px){.cover{width:92px;height:92px}.title{font-size:18px}}
</style>
</head>
<body>
  <div class="card" aria-live="polite">
    <div id="bg" class="bg"></div>
    <div id="content" class="row" hidden>
      <div class="cover"><img id="cover" alt="Omslag"><div class="play" aria-hidden="true"></div></div>
      <div class="meta">
        <h1 id="title" class="title">–</h1>
        <div id="artist" class="artist">–</div>
        <div class="times"><div id="tStart">00:00</div><div id="tEnd" class="right">00:00</div></div>
        <div class="progress"><div id="bar" class="bar"></div></div>
      </div>
    </div>
    <div id="empty" class="empty">Ingen låt spelas just nu.</div>
  </div>
<script>
  const API = "/now-playing"; // ändra till full Render-URL om du bäddar in på annan domän
  const el = {
    bg:document.getElementById("bg"), content:document.getElementById("content"), empty:document.getElementById("empty"),
    cover:document.getElementById("cover"), title:document.getElementById("title"), artist:document.getElementById("artist"),
    tStart:document.getElementById("tStart"), tEnd:document.getElementById("tEnd"), bar:document.getElementById("bar")
  };
  let last=null, ticker;
  const ms=(x=0)=>{x=Math.max(0,x|0);const s=Math.floor(x/1000),m=Math.floor(s/60);return `${m}:${String(s%60).padStart(2,"0")}`};
  function paint(d){
    if(!d||!d.playing){ el.content.hidden=true; el.empty.hidden=false; el.bg.style.backgroundImage=""; return; }
    el.content.hidden=false; el.empty.hidden=true;
    el.title.textContent=d.title||"Okänd låt";
    el.artist.textContent=(d.artists||[]).join(", ")||d.album||"";
    const p=d.progress_ms||0, t=d.duration_ms||1;
    el.tStart.textContent=ms(p); el.tEnd.textContent=ms(t);
    el.bar.style.width=(100*p/t)+"%";
    if(d.image){ el.cover.src=d.image; el.bg.style.backgroundImage=`url("${d.image}")`; }
  }
  async function poll(){ try{ const r=await fetch(API,{cache:"no-store"}); last=await r.json(); paint(last);}catch{} }
  function start(){ clearInterval(ticker); ticker=setInterval(()=>{ if(!last?.playing) return; last.progress_ms=Math.min((last.progress_ms||0)+1000,last.duration_ms||0); paint(last); },1000); }
  poll().then(start); setInterval(poll,10000);
</script>
</body>
</html>
